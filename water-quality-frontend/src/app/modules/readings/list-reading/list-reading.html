<app-navbar></app-navbar>

<div class="page">
  <div class="header-container">
    <h2>Water Readings</h2>
    <a routerLink="/readings/add" class="add-btn">+ Add New Reading</a>
  </div>

  <div *ngIf="message" class="success-banner">
    {{ message }}
  </div>

  <p
    *ngIf="(readings$ | async)?.length === 0"
    style="margin: 20px; color: #64748b; text-align: center"
  >
    No readings found. Click "Add New Reading" to create one.
  </p>

  <div class="table-wrapper">
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date</th>
          <th>Location</th>
          <th>pH</th>
          <th>Turbidity</th>
          <th>TDS</th>
          <th>Temp</th>
          <th>Quality</th>
          <th style="width: 150px">Action</th>
        </tr>
      </thead>

      <tbody>
        <ng-container *ngIf="readings$ | async as readings">
          <tr *ngFor="let r of readings">
            <td>{{ r.id }}</td>
            <td>{{ r.timestamp | date : 'shortDate' }}</td>
            <td>
              <strong>{{ r.location }}</strong>
            </td>
            <td>{{ r.ph }}</td>
            <td>{{ r.turbidity }}</td>
            <td>{{ r.tds }}</td>
            <td>{{ r.temperature }}Â°C</td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  good: r.quality === 'Good',
                  moderate: r.quality === 'Moderate',
                  poor: r.quality === 'Poor'
                }"
              >
                {{ r.quality }}
              </span>
            </td>

            <td>
              <div class="action-buttons">
                <button class="btn-edit" [routerLink]="['/readings/edit', r.id]">Edit</button>

                <button class="btn-delete" (click)="confirmDelete(r.id)">Delete</button>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-box">
    <h3>Are you sure?</h3>
    <p style="color: #64748b; margin-top: 10px">
      Do you really want to delete this reading? This process cannot be undone.
    </p>
    <div class="modal-actions">
      <button class="cancel-btn" (click)="closeModal()">Cancel</button>
      <button class="confirm-btn" (click)="deleteNow()">Yes, Delete</button>
    </div>
  </div>
</div>
