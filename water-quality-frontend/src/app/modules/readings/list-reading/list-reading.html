<app-navbar></app-navbar>

<div class="page">
  <div class="header-container">
    <h2>Water Readings</h2>
    <a routerLink="/readings/add" class="btn btn-primary">
      <i class="fas fa-plus" style="margin-right: 8px"></i> Add New Reading
    </a>
  </div>

  <div *ngIf="message" class="success-banner">
    <i class="fas fa-check-circle"></i> {{ message }}
  </div>

  <p *ngIf="(readings$ | async)?.length === 0" class="empty-state">
    No readings found. Click "Add New Reading" to create one.
  </p>

  <div class="table-wrapper">
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date</th>
          <th>Location</th>
          <th>pH</th>
          <th>Turbidity</th>
          <th>TDS</th>
          <th>Temp</th>
          <th>Quality</th>
          <th style="text-align: right; padding-right: 20px">Action</th>
        </tr>
      </thead>

      <tbody>
        <ng-container *ngIf="readings$ | async as readings">
          <tr *ngFor="let r of readings">
            <td>#{{ r.id }}</td>
            <td>{{ r.timestamp | date : 'MMM d, y, h:mm a' }}</td>
            <td>
              <strong>{{ r.location }}</strong>
            </td>
            <td>{{ r.ph }}</td>
            <td>{{ r.turbidity }}</td>
            <td>{{ r.tds }}</td>
            <td>{{ r.temperature }}Â°C</td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  good: r.quality === 'Good',
                  moderate: r.quality === 'Moderate',
                  poor: r.quality === 'Poor'
                }"
              >
                {{ r.quality }}
              </span>
            </td>
            <td style="text-align: right">
              <div class="action-buttons">
                <button class="btn-icon edit" [routerLink]="['/readings/edit', r.id]" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon delete" (click)="confirmDelete(r.id)" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-box card">
    <div class="modal-icon danger">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <h3>Delete Reading?</h3>
    <p>Are you sure you want to delete this reading? This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeModal()">Cancel</button>
      <button class="btn-delete" (click)="deleteNow()">Delete</button>
    </div>
  </div>
</div>
